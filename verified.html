<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Account Verification | VIP Task</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
<style>
@import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap');
*{margin:0;padding:0;box-sizing:border-box;font-family:'Poppins',sans-serif;}
body{background:#0f1724;color:#fff;display:flex;flex-direction:column;align-items:center;min-height:100vh;padding:20px;}
.header{width:100%;padding:15px;text-align:center;font-size:22px;background:#162447;color:#f0a500;font-weight:bold;box-shadow:0 2px 6px rgba(0,0,0,0.5);}
.card{background:#1e293b;width:95%;max-width:400px;padding:20px;border-radius:12px;margin-top:15px;box-shadow:0 0 15px rgba(255,255,255,0.1);}
.card h3{margin-bottom:12px;text-align:center;color:#f59e0b;}
.input, select{width:100%;padding:10px;margin:8px 0;border:none;border-radius:8px;background:#0f1724;color:#fff;}
.btn{width:100%;padding:10px;background:#38bdf8;color:#000;border:none;border-radius:8px;font-weight:600;cursor:pointer;margin-top:10px;}
.btn:hover{background:#22c55e;color:#fff;}
.status{padding:6px 10px;border-radius:8px;margin-top:6px;display:inline-block;}
.verified{background:#22c55e;color:#fff;}
.unverified{background:#ef4444;color:#fff;}
.footer-nav{position:fixed;bottom:0;left:0;width:100%;background:#1e293b;display:flex;justify-content:space-around;padding:10px 0;border-top:1px solid #334155;}
.footer-nav a{color:#fff;text-decoration:none;text-align:center;font-size:14px;}
.footer-nav i{display:block;font-size:18px;margin-bottom:3px;}
</style>
</head>
<body>

<div class="header">Account Verification</div>

<div class="card profile-card">
  <div style="text-align:center;">
    <img id="profilePic" src="https://i.ibb.co/7JpLkpK/user.png" style="width:80px;height:80px;border-radius:50%;margin-bottom:10px;">
    <h3 id="userName">Loading...</h3>
    <p>UID: <span id="userUID"></span></p>
    <p>Balance: <b>$<span id="balance">0</span></b></p>
    <p>Status: <span id="verifiedStatus" class="status unverified">Unverified</span></p>
  </div>
</div>

<div class="card">
  <h3>Verify Your Account</h3>
  <select id="method" class="input">
    <option value="">Select Method</option>
    <option value="bkash">bKash</option>
    <option value="nagad">Nagad</option>
    <option value="bank">Bank</option>
  </select>
  <input id="amount" class="input" type="number" placeholder="Amount Paid">
  <input id="number" class="input" type="text" placeholder="Phone/Bank Account">
  <button id="submitBtn" class="btn">Submit for Verification</button>
  <p id="msg" style="text-align:center;margin-top:8px;"></p>
</div>

<div class="footer-nav">
  <a href="dashboard.html"><i class="fa-solid fa-house"></i>Home</a>
  <a href="task.html"><i class="fa-solid fa-list-check"></i>Tasks</a>
  <a href="reffer.html"><i class="fa-solid fa-users"></i>Refer</a>
  <a href="withdraw.html"><i class="fa-solid fa-wallet"></i>Withdraw</a>
  <a href="account.html" class="active"><i class="fa-solid fa-user"></i>Account</a>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.3.0/firebase-app.js";
import { getDatabase, ref, get, push, set, child } from "https://www.gstatic.com/firebasejs/10.3.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyApIiGovH14024loNQMVTsm_qE3H2Fa658",
  authDomain: "eshopingbddd.firebaseapp.com",
  databaseURL: "https://eshopingbddd-default-rtdb.firebaseio.com",
  projectId: "eshopingbddd",
  storageBucket: "eshopingbddd.firebasestorage.app",
  messagingSenderId: "19777305233",
  appId: "1:19777305233:web:33f3871db06beeaf129d30"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

const uid = localStorage.getItem('uid');
if(!uid){alert("Please login first!"); window.location='register.html';}

const userRef = ref(db,'users/'+uid);
const verificationRef = ref(db,'verifications');

async function loadUser(){
  const snap = await get(userRef);
  if(snap.exists()){
    const data = snap.val();
    document.getElementById('userName').textContent = (data.firstName||'')+' '+(data.lastName||'');
    document.getElementById('userUID').textContent = data.uid||uid;
    document.getElementById('balance').textContent = data.balance||0;
    document.getElementById('profilePic').src = data.profilePic || "https://i.ibb.co/7JpLkpK/user.png";
    const verified = data.verified || false;
    document.getElementById('verifiedStatus').textContent = verified ? 'Verified' : 'Unverified';
    document.getElementById('verifiedStatus').className = verified ? 'status verified' : 'status unverified';

    // If already verified, disable form
    if(verified){
      document.getElementById('submitBtn').disabled = true;
      document.getElementById('submitBtn').textContent = "Already Verified ✅";
    }
  }
}

loadUser();

// Submit verification
document.getElementById('submitBtn').addEventListener('click', async ()=>{
  const method = document.getElementById('method').value;
  const amount = Number(document.getElementById('amount').value);
  const number = document.getElementById('number').value.trim();

  if(!method || !amount || !number){
    document.getElementById('msg').textContent = "All fields are required!";
    return;
  }

  const r = push(verificationRef);
  await set(child(verificationRef, r.key), {
    id: r.key,
    uid: uid,
    method: method,
    amount: amount,
    number: number,
    status: "pending",
    time: Date.now()
  });

  document.getElementById('msg').textContent = "✅ Verification submitted. Waiting for admin approval.";
  document.getElementById('submitBtn').disabled = true;
});
</script>
</body>
</html>