<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Referral | VIP Task</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
<style>
@import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap');
:root{
  --bg:#0f1724;--card:#111827;--accent:#f59e0b;--muted:#9ca3af;
}
body{font-family:'Poppins',sans-serif;background:linear-gradient(135deg,#060d1f,#091a3a);color:#fff;margin:0;padding-bottom:100px;}
.container{max-width:900px;margin:20px auto;padding:18px;}
.card{background:#0f1724;padding:16px;border-radius:12px;margin-bottom:16px;box-shadow:0 0 12px rgba(245,158,11,0.3);}
.input{width:100%;padding:10px;border-radius:8px;border:none;background:#071226;color:#fff;margin:8px 0;}
.btn,.link-btn{background:var(--accent);color:#07102a;padding:8px 12px;border-radius:8px;border:none;cursor:pointer;font-weight:600;}
h2{text-align:center;color:var(--accent);}
p,small{color:var(--muted);}
a{text-decoration:none;color:var(--accent);}
.verified{color:#10b981;font-weight:600;}
.unverified{color:#ef4444;font-weight:600;}
.ref-list{margin-top:10px;}
.ref-item{border-bottom:1px solid rgba(255,255,255,0.1);padding:8px 0;display:flex;justify-content:space-between;align-items:center;}
.ref-item:last-child{border:none;}
.ref-item span{font-weight:600;}
/* Bottom Navigation */
.bottom-nav{
  position:fixed;bottom:0;left:0;width:100%;
  background:#111827;display:flex;justify-content:space-around;
  border-top:1px solid rgba(255,255,255,0.1);
  box-shadow:0 -3px 10px rgba(0,0,0,0.4);
  padding:8px 0;z-index:1000;
}
.bottom-nav a{
  color:#ccc;text-decoration:none;font-size:13px;text-align:center;flex:1;
  display:flex;flex-direction:column;align-items:center;transition:0.3s;
}
.bottom-nav a i{font-size:20px;margin-bottom:3px;}
.bottom-nav a.active, .bottom-nav a:hover{color:var(--accent);}
</style>
</head>
<body>
<div class="container">
  <h2>üéÅ ‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶∏‡¶ø‡¶∏‡ßç‡¶ü‡ßá‡¶Æ</h2>

  <div class="card">
    <h4>‡¶§‡ßã‡¶Æ‡¶æ‡¶∞ ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤ ‡¶≤‡¶ø‡¶Ç‡¶ï</h4>
    <input id="refLink" class="input" readonly />
    <button class="link-btn" id="copyBtn"><i class="fa-solid fa-copy"></i> ‡¶ï‡¶™‡¶ø ‡¶≤‡¶ø‡¶Ç‡¶ï</button>
    <p>‡¶™‡ßç‡¶∞‡¶§‡¶ø Verified ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá ‡¶¨‡ßã‡¶®‡¶æ‡¶∏: <span id="bonusPerRef">0</span> ‡¶ü‡¶æ‡¶ï‡¶æ</p>
  </div>

  <div class="card">
    <h4>‡¶§‡ßã‡¶Æ‡¶æ‡¶∞ ‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶π‡¶ø‡¶∏‡ßç‡¶ü‡¶∞‡¶ø</h4>
    <p>‡¶Æ‡ßã‡¶ü ‡¶∞‡ßá‡¶´‡¶æ‡¶∞: <span id="refCount">0</span></p>
    <p>‡¶Æ‡ßã‡¶ü ‡¶Ü‡ßü: <span id="refBonus">0</span> ‡¶ü‡¶æ‡¶ï‡¶æ</p>

    <div class="ref-list" id="refList">
      <small>Loading...</small>
    </div>
  </div>
</div>

<!-- üî• Bottom Navigation -->
<div class="bottom-nav">
  <a href="dashboard.html"><i class="fas fa-home"></i>Home</a>
  <a href="task.html"><i class="fas fa-tasks"></i>Tasks</a>
  <a href="reffer.html" class="active"><i class="fas fa-user-friends"></i>Refer</a>
  <a href="account.html"><i class="fas fa-user-circle"></i>Account</a>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.3.0/firebase-app.js";
import { getDatabase, ref, onValue, get, child } from "https://www.gstatic.com/firebasejs/10.3.0/firebase-database.js";

// Firebase config
const firebaseConfig = {
  apiKey: "AIzaSyApIiGovH14024loNQMVTsm_qE3H2Fa658",
  authDomain: "eshopingbddd.firebaseapp.com",
  databaseURL: "https://eshopingbddd-default-rtdb.firebaseio.com",
  projectId: "eshopingbddd",
  storageBucket: "eshopingbddd.appspot.com",
  messagingSenderId: "19777305233",
  appId: "1:19777305233:web:33f3871db06beeaf129d30"
};
const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

// user info
const uid = localStorage.getItem('uid');
const siteBase = location.origin + '/register.html?ref=';
document.getElementById('refLink').value = siteBase + uid;

// copy link
document.getElementById('copyBtn').addEventListener('click', ()=>{
  navigator.clipboard.writeText(document.getElementById('refLink').value);
  alert('‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶≤‡¶ø‡¶Ç‡¶ï ‡¶ï‡¶™‡¶ø ‡¶π‡ßü‡ßá‡¶õ‡ßá ‚úÖ');
});

// Load referral bonus
const bonusRef = ref(db, 'settings/refBonus');
onValue(bonusRef, snap=>{
  document.getElementById('bonusPerRef').textContent = snap.val() || 0;
});

// Load referrals
const refsRef = ref(db, 'referrals');
onValue(refsRef, async snap=>{
  const data = snap.val() || {};
  let count = 0, bonusTotal = 0;
  const listEl = document.getElementById('refList');
  listEl.innerHTML = '';
  for(const k of Object.keys(data).reverse()){
    const r = data[k];
    if(r.refBy !== uid) continue;

    // check if referred user is verified
    const userSnap = await get(child(ref(db), `users/${r.refUser}`));
    const verified = userSnap.exists() ? userSnap.val().verified : false;

    const div = document.createElement('div');
    div.className = 'ref-item';
    div.innerHTML = `
      <span>${r.refUser}</span>
      <span class="${verified?'verified':'unverified'}">${verified?'Verified':'Unverified'}</span>
    `;
    listEl.appendChild(div);

    if(verified){
      count++;
      bonusTotal += Number(r.bonus || 0);
    }
  }
  document.getElementById('refCount').textContent = count;
  document.getElementById('refBonus').textContent = bonusTotal;
});
</script>
</body>
</html>