<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>VIP Task Center</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
<style>
@import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap');
:root{--bg:#0f1724;--card:#111827;--accent:#f59e0b;--muted:#9ca3af;}
body{font-family:'Poppins',sans-serif;background:linear-gradient(135deg,#0a1122,#0f1724);color:#fff;margin:0;padding-bottom:70px;}
.header{padding:14px 18px;background:#162447;text-align:center;}
.header h1{margin:0;color:var(--accent);font-size:20px}
.container{max-width:900px;margin:20px auto;padding:10px}
.card{background:var(--card);padding:16px;border-radius:12px;box-shadow:0 6px 20px rgba(0,0,0,0.5);margin-bottom:14px}
.task{border-bottom:1px solid rgba(255,255,255,0.08);padding:12px 0;display:flex;gap:10px}
.task img{width:80px;height:80px;border-radius:10px;object-fit:cover}
.task-info{flex:1}
.btn{background:var(--accent);color:#000;border:none;border-radius:8px;padding:8px 12px;font-weight:600;cursor:pointer}
.file-upload{border:2px dashed rgba(255,255,255,0.2);padding:15px;text-align:center;border-radius:10px;margin:6px 0;}
.file-upload:hover{border-color:var(--accent)}
.bottom-nav{position:fixed;bottom:0;left:0;width:100%;background:#111827;display:flex;justify-content:space-around;padding:8px 0;}
.bottom-nav a{color:#ccc;text-decoration:none;font-size:13px;text-align:center;flex:1;}
.bottom-nav a.active{color:var(--accent);}
</style>
</head>
<body>
<div class="header"><h1>VIP Task Center</h1></div>
<div class="container">
  <div class="card">
    <h3>Available Tasks</h3>
    <div id="taskList">Loading...</div>
  </div>

  <div class="card" id="proofBox" style="display:none">
    <h3>Submit Proof</h3>
    <input type="file" id="proof1" accept="image/*,video/*" class="file-upload">
    <input type="file" id="proof2" accept="image/*,video/*" class="file-upload">
    <button class="btn" id="submitProof">Submit Proof</button>
    <p id="msg"></p>
  </div>
</div>

<div class="bottom-nav">
  <a href="dashboard.html"><i class="fas fa-home"></i>Home</a>
  <a href="task.html" class="active"><i class="fas fa-tasks"></i>Tasks</a>
  <a href="taskhistory.html"><i class="fas fa-clock-rotate-left"></i>History</a>
  <a href="account.html"><i class="fas fa-user-circle"></i>Account</a>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.3.0/firebase-app.js";
import { getDatabase, ref, onValue, push, set } from "https://www.gstatic.com/firebasejs/10.3.0/firebase-database.js";
import { getStorage, ref as sRef, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.3.0/firebase-storage.js";

const firebaseConfig = {
  apiKey: "AIzaSyApIiGovH14024loNQMVTsm_qE3H2Fa658",
  authDomain: "eshopingbddd.firebaseapp.com",
  databaseURL: "https://eshopingbddd-default-rtdb.firebaseio.com",
  projectId: "eshopingbddd",
  storageBucket: "eshopingbddd.appspot.com",
  messagingSenderId: "19777305233",
  appId: "1:19777305233:web:33f3871db06beeaf129d30"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const storage = getStorage(app);

const uid = localStorage.getItem('uid');
const taskList = document.getElementById('taskList');
const proofBox = document.getElementById('proofBox');
const msg = document.getElementById('msg');
let currentTask = null;

// Load tasks
onValue(ref(db, 'tasks'), snap => {
  const data = snap.val();
  taskList.innerHTML = '';
  if (!data) { taskList.innerHTML = '<p>No tasks available.</p>'; return; }
  Object.keys(data).reverse().forEach(id => {
    const t = data[id];
    const div = document.createElement('div');
    div.className = 'task';
    div.innerHTML = `
      <img src="${t.fileUrl}" alt="task">
      <div class="task-info">
        <b>${t.title}</b>
        <p style="color:#9ca3af">${t.desc}</p>
        <small>Reward: ${t.reward} coins</small><br>
        <button class="btn" onclick="startTask('${id}')">Start Task</button>
      </div>
    `;
    taskList.appendChild(div);
  });
});

window.startTask = (id) => {
  currentTask = id;
  proofBox.style.display = 'block';
  msg.textContent = '';
  window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
};

document.getElementById('submitProof').addEventListener('click', async () => {
  if (!uid) return alert('Please login first!');
  if (!currentTask) return alert('Select a task first!');

  const file1 = document.getElementById('proof1').files[0];
  const file2 = document.getElementById('proof2').files[0];
  if (!file1 || !file2) { msg.textContent = '❌ Please upload both proofs.'; return; }

  msg.textContent = 'Uploading... Please wait.';

  const upload = async (file) => {
    const fileRef = sRef(storage, `proofs/${uid}_${Date.now()}_${file.name}`);
    await uploadBytes(fileRef, file);
    return await getDownloadURL(fileRef);
  };

  const url1 = await upload(file1);
  const url2 = await upload(file2);

  const subRef = push(ref(db, 'submissions'));
  await set(subRef, { uid, taskId: currentTask, proof1: url1, proof2: url2, status: 'pending', time: Date.now() });

  msg.textContent = '✅ Proof submitted successfully! Waiting for approval.';
  proofBox.style.display = 'none';
});
</script>
</body>
</html>