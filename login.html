<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>VIP Login</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
<style>
body{
  font-family:'Poppins',sans-serif;
  background:radial-gradient(circle at top left,#141E30,#243B55);
  color:#fff;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
  overflow:hidden;
}
.container{
  width:100%;
  max-width:420px;
  background:rgba(30,30,60,0.95);
  padding:35px;
  border-radius:20px;
  box-shadow:0 0 20px rgba(255,255,255,0.1);
  position:relative;
}
h2{text-align:center;color:#ffcc00;margin-bottom:25px;}
input{
  width:100%;
  padding:12px;
  margin:10px 0;
  border:none;
  border-radius:10px;
  background:#2c2c54;
  color:#fff;
}
input::placeholder{color:#ccc;}
button{
  width:100%;
  padding:12px;
  margin-top:12px;
  border:none;
  border-radius:10px;
  background:linear-gradient(135deg,#ffcc00,#ff9900);
  color:#1a1a2e;
  font-weight:bold;
  cursor:pointer;
  position:relative;
  overflow:hidden;
}
button:hover{transform:translateY(-2px);background:linear-gradient(135deg,#ffd633,#ffb733);}
#msg{text-align:center;margin-top:15px;font-weight:500;}
.error{color:#ff4d4d;}
.success{color:#00ff99;}
/* Loading overlay */
#loadingOverlay{
  position:absolute;
  inset:0;
  background:rgba(0,0,0,0.7);
  display:flex;
  justify-content:center;
  align-items:center;
  flex-direction:column;
  border-radius:20px;
  display:none;
  z-index:10;
}
.spinner{
  width:50px;
  height:50px;
  border:5px solid #ccc;
  border-top-color:#ffcc00;
  border-radius:50%;
  animation: spin 1s linear infinite;
  margin-bottom:15px;
}
@keyframes spin{
  0%{transform:rotate(0deg);}
  100%{transform:rotate(360deg);}
}
</style>
</head>
<body>
<div class="container">
<h2><i class="fa-solid fa-right-to-bracket"></i> VIP Login</h2>
<form id="loginForm">
<input type="email" id="email" placeholder="Email @gmail.com" required>
<input type="password" id="password" placeholder="Password" required>
<button type="submit"><i class="fa-solid fa-lock"></i> Login</button>
<p id="msg"></p>
</form>
<p style="text-align:center;margin-top:10px;">Don't have an account? <a href="register.html" style="color:#ffcc00;">Register</a></p>

<!-- Loading Overlay -->
<div id="loadingOverlay">
  <div class="spinner"></div>
  <p id="loadingText">Logging in...</p>
</div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.3.0/firebase-app.js";
import { getDatabase, ref, get, child } from "https://www.gstatic.com/firebasejs/10.3.0/firebase-database.js";

// Firebase Config
const firebaseConfig = {
  apiKey: "AIzaSyApIiGovH14024loNQMVTsm_qE3H2Fa658",
  authDomain: "eshopingbddd.firebaseapp.com",
  databaseURL: "https://eshopingbddd-default-rtdb.firebaseio.com",
  projectId: "eshopingbddd",
  storageBucket: "eshopingbddd.appspot.com",
  messagingSenderId: "19777305233",
  appId: "1:19777305233:web:33f3871db06beeaf129d30"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

// Already logged-in check
const checkUID = localStorage.getItem('uid');
if(checkUID){
    window.location = 'dashboard.html';
}

// Elements
const form = document.getElementById('loginForm');
const msg = document.getElementById('msg');
const overlay = document.getElementById('loadingOverlay');
const loadingText = document.getElementById('loadingText');

form.addEventListener('submit', async (e)=>{
  e.preventDefault();
  msg.textContent = '';
  
  const email = document.getElementById('email').value.trim();
  const password = document.getElementById('password').value.trim();

  overlay.style.display = 'flex';
  loadingText.textContent = 'Checking credentials...';

  try{
    const dbRef = ref(db);
    const snapshot = await get(child(dbRef,"users"));
    let found = false;
    let currentUser = null;

    snapshot.forEach(userSnap=>{
      const u = userSnap.val();
      if(u.email===email && u.password===password){
          found = true;
          currentUser = u;
      }
    });

    if(found){
        loadingText.textContent = `Welcome ${currentUser.firstName}!`;
        localStorage.setItem('uid', currentUser.uid);

        setTimeout(()=>{ window.location='dashboard.html'; },1800);
    } else {
        overlay.style.display='none';
        msg.textContent = "Invalid Email or Password!";
        msg.className = "error";
    }

  }catch(err){
      overlay.style.display='none';
      msg.textContent = err.message;
      msg.className='error';
  }
});
</script>
</body>
</html>